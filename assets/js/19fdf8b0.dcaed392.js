"use strict";(self.webpackChunkfiber_docs=self.webpackChunkfiber_docs||[]).push([["70368"],{23579:function(e,t,n){n.r(t),n.d(t,{frontMatter:()=>r,toc:()=>a,default:()=>h,metadata:()=>i,assets:()=>d,contentTitle:()=>c});var i=JSON.parse('{"id":"middleware/cache","title":"Cache","description":"Cache middleware for Fiber that intercepts responses and stores the body, Content-Type, and status code under a key derived from the request path and method. Special thanks to @codemicro for contributing this middleware to Fiber core.","source":"@site/docs/core/middleware/cache.md","sourceDirName":"middleware","slug":"/middleware/cache","permalink":"/next/middleware/cache","draft":false,"unlisted":false,"editUrl":"https://github.com/gofiber/fiber/edit/main/docs/middleware/cache.md","tags":[],"version":"current","lastUpdatedAt":1771794478000,"frontMatter":{"id":"cache"},"sidebar":"left_sidebar","previous":{"title":"BasicAuth","permalink":"/next/middleware/basicauth"},"next":{"title":"Compress","permalink":"/next/middleware/compress"}}'),l=n(74848),s=n(84429);let r={id:"cache"},c="Cache",d={},a=[{value:"Signatures",id:"signatures",level:2},{value:"Examples",id:"examples",level:2},{value:"Config",id:"config",level:2},{value:"Default Config",id:"default-config",level:2}];function o(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"cache",children:"Cache"})}),"\n",(0,l.jsxs)(t.p,{children:["Cache middleware for ",(0,l.jsx)(t.a,{href:"https://github.com/gofiber/fiber",children:"Fiber"})," that intercepts responses and stores the body, ",(0,l.jsx)(t.code,{children:"Content-Type"}),", and status code under a key derived from the request path and method. Special thanks to ",(0,l.jsx)(t.a,{href:"https://github.com/codemicro/fiber-cache",children:"@codemicro"})," for contributing this middleware to Fiber core."]}),"\n",(0,l.jsx)(t.p,{children:"By default, cached responses expire after five minutes and the middleware stores up to 1\u202FMB of response bodies."}),"\n",(0,l.jsx)(t.p,{children:"Request directives"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"Cache-Control: no-cache"})," returns the latest response while still caching it, so the status is always ",(0,l.jsx)(t.code,{children:"miss"}),"."]}),"\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.code,{children:"Cache-Control: no-store"})," skips caching and always forwards a fresh response."]}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["If the response includes a ",(0,l.jsx)(t.code,{children:"Cache-Control: max-age"})," directive, its value sets the cache entry's expiration."]}),"\n",(0,l.jsx)(t.p,{children:"Cacheable status codes"}),"\n",(0,l.jsx)(t.p,{children:"The middleware caches these RFC 7231 status codes:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"200: OK"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"203: Non-Authoritative Information"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"204: No Content"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"206: Partial Content"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"300: Multiple Choices"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"301: Moved Permanently"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"404: Not Found"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"405: Method Not Allowed"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"410: Gone"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"414: URI Too Long"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.code,{children:"501: Not Implemented"})}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["Responses with other status codes result in an ",(0,l.jsx)(t.code,{children:"unreachable"})," cache status."]}),"\n",(0,l.jsx)(t.p,{children:"For more about cacheable status codes and RFC 7231, see:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Cacheable",children:"Cacheable - MDN Web Docs"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7231",children:"RFC7231 - Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"signatures",children:"Signatures"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"func New(config ...Config) fiber.Handler\n"})}),"\n",(0,l.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(t.p,{children:"Import the middleware package:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'import (\n    "github.com/gofiber/fiber/v3"\n    "github.com/gofiber/fiber/v3/middleware/cache"\n    "github.com/gofiber/utils/v2"\n)\n'})}),"\n",(0,l.jsx)(t.p,{children:"Once your Fiber app is initialized, register the middleware:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'// Initialize default config\napp.Use(cache.New())\n\n// Or extend the config for customization\napp.Use(cache.New(cache.Config{\n    Next: func(c fiber.Ctx) bool {\n        return fiber.Query[bool](c, "noCache")\n    },\n    Expiration: 30 * time.Minute,\n    DisableCacheControl: true,\n}))\n'})}),"\n",(0,l.jsx)(t.p,{children:"Customize the cache key and expiration; the HTTP method is appended automatically:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'app.Use(cache.New(cache.Config{\n    ExpirationGenerator: func(c fiber.Ctx, cfg *cache.Config) time.Duration {\n        newCacheTime, _ := strconv.Atoi(c.GetRespHeader("Cache-Time", "600"))\n        return time.Second * time.Duration(newCacheTime)\n    },\n    KeyGenerator: func(c fiber.Ctx) string {\n        return utils.CopyString(c.Path())\n    },\n}))\n\napp.Get("/", func(c fiber.Ctx) error {\n    c.Response().Header.Add("Cache-Time", "6000")\n    return c.SendString("hi")\n})\n'})}),"\n",(0,l.jsxs)(t.p,{children:["Use ",(0,l.jsx)(t.code,{children:"CacheInvalidator"})," to invalidate entries programmatically:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'app.Use(cache.New(cache.Config{\n    CacheInvalidator: func(c fiber.Ctx) bool {\n        return fiber.Query[bool](c, "invalidateCache")\n    },\n}))\n'})}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"CacheInvalidator"})," defines custom invalidation rules. Return ",(0,l.jsx)(t.code,{children:"true"})," to bypass the cache. In the example above, setting the ",(0,l.jsx)(t.code,{children:"invalidateCache"})," query parameter to ",(0,l.jsx)(t.code,{children:"true"})," invalidates the entry."]}),"\n",(0,l.jsxs)(t.p,{children:["Cache keys are masked in logs and error messages by default. Set ",(0,l.jsx)(t.code,{children:"DisableValueRedaction"})," to ",(0,l.jsx)(t.code,{children:"true"})," if you explicitly need the raw key for debugging."]}),"\n",(0,l.jsx)(t.h2,{id:"config",children:"Config"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Property"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Next"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Next defines a function that is executed before creating the cache entry and can be used to execute the request without cache creation. If an entry already exists, it will be used. If you want to completely bypass the cache functionality in certain cases, you should use the ",(0,l.jsx)(t.a,{href:"/next/middleware/skip",children:"skip middleware"}),"."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"nil"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Expiration"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"time.Duration"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Expiration is the time that a cached response will live."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"5 * time.Minute"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"CacheHeader"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"string"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:'CacheHeader is the header on the response header that indicates the cache status, with the possible return values "hit," "miss," or "unreachable."'}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"X-Cache"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"DisableCacheControl"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["DisableCacheControl omits the ",(0,l.jsx)(t.code,{children:"Cache-Control"})," header when set to ",(0,l.jsx)(t.code,{children:"true"}),"."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"false"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"CacheInvalidator"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) bool"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"CacheInvalidator defines a function that is executed before checking the cache entry. It can be used to invalidate the existing cache manually by returning true."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"nil"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"DisableValueRedaction"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Turns off cache key redaction in logs and error messages when set to ",(0,l.jsx)(t.code,{children:"true"}),"."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"false"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"KeyGenerator"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) string"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"KeyGenerator allows you to generate custom keys. The HTTP method is appended automatically."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(c fiber.Ctx) string { return utils.CopyString(c.Path()) }"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"ExpirationGenerator"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx, *cache.Config) time.Duration"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"ExpirationGenerator allows you to generate custom expiration keys based on the request."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"nil"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Storage"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fiber.Storage"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Storage is used to store the state of the middleware."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"In-memory store"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"StoreResponseHeaders"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"StoreResponseHeaders allows you to store additional headers generated by next middlewares & handler."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"false"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"MaxBytes"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"uint"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"MaxBytes is the maximum number of bytes of response bodies simultaneously stored in cache."}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,l.jsx)(t.code,{children:"1 * 1024 * 1024"})," (~1 MB)"]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Methods"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"[]string"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Methods specifies the HTTP methods to cache."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"[]string{fiber.MethodGet, fiber.MethodHead}"})})]})]})]}),"\n",(0,l.jsx)(t.h2,{id:"default-config",children:"Default Config"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'var ConfigDefault = Config{\n    Next:         nil,\n    Expiration:   5 * time.Minute,\n    CacheHeader:  "X-Cache",\n    DisableCacheControl: false,\n    CacheInvalidator: nil,\n    DisableValueRedaction: false,\n    KeyGenerator: func(c fiber.Ctx) string {\n        return utils.CopyString(c.Path())\n    },\n    ExpirationGenerator:  nil,\n    StoreResponseHeaders: false,\n    Storage:              nil,\n    MaxBytes:             1 * 1024 * 1024,\n    Methods: []string{fiber.MethodGet, fiber.MethodHead},\n}\n'})})]})}function h(e={}){let{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},84429:function(e,t,n){n.d(t,{R:()=>r,x:()=>c});var i=n(96540);let l={},s=i.createContext(l);function r(e){let t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);
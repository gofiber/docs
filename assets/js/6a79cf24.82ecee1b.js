"use strict";(self.webpackChunkfiber_docs=self.webpackChunkfiber_docs||[]).push([["94326"],{27061:function(e,t,i){i.r(t),i.d(t,{frontMatter:()=>s,toc:()=>c,default:()=>x,metadata:()=>n,assets:()=>a,contentTitle:()=>d});var n=JSON.parse('{"id":"middleware/limiter","title":"Limiter","description":"The Limiter middleware for Fiber throttles repeated requests to public APIs or endpoints such as password resets. It\'s also useful for API clients, web crawlers, or other tasks that need rate limiting.","source":"@site/docs/core/middleware/limiter.md","sourceDirName":"middleware","slug":"/middleware/limiter","permalink":"/next/middleware/limiter","draft":false,"unlisted":false,"editUrl":"https://github.com/gofiber/fiber/edit/main/docs/middleware/limiter.md","tags":[],"version":"current","lastUpdatedAt":1771794478000,"frontMatter":{"id":"limiter"},"sidebar":"left_sidebar","previous":{"title":"KeyAuth","permalink":"/next/middleware/keyauth"},"next":{"title":"Logger","permalink":"/next/middleware/logger"}}'),l=i(74848),r=i(84429);let s={id:"limiter"},d="Limiter",a={},c=[{value:"Signatures",id:"signatures",level:2},{value:"Examples",id:"examples",level:2},{value:"Sliding window",id:"sliding-window",level:2},{value:"Dynamic limit",id:"dynamic-limit",level:2},{value:"Dynamic expiration",id:"dynamic-expiration",level:2},{value:"Config",id:"config",level:2},{value:"Default Config",id:"default-config",level:2},{value:"Custom Storage/Database",id:"custom-storagedatabase",level:3}];function o(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"limiter",children:"Limiter"})}),"\n",(0,l.jsxs)(t.p,{children:["The Limiter middleware for ",(0,l.jsx)(t.a,{href:"https://github.com/gofiber/fiber",children:"Fiber"})," throttles repeated requests to public APIs or endpoints such as password resets. It's also useful for API clients, web crawlers, or other tasks that need rate limiting."]}),"\n",(0,l.jsxs)(t.p,{children:["Limiter redacts request keys in error paths by default so storage identifiers and rate-limit keys don't leak into logs. Set ",(0,l.jsx)(t.code,{children:"DisableValueRedaction"})," to ",(0,l.jsx)(t.code,{children:"true"})," when you explicitly need the raw key for troubleshooting."]}),"\n",(0,l.jsx)(t.admonition,{type:"note",children:(0,l.jsxs)(t.p,{children:["This middleware uses our ",(0,l.jsx)(t.a,{href:"https://github.com/gofiber/storage",children:"Storage"})," package to support various databases through a single interface. The default configuration for this middleware saves data to memory, see the examples below for other databases."]})}),"\n",(0,l.jsx)(t.admonition,{type:"note",children:(0,l.jsx)(t.p,{children:"This module does not share state with other processes/servers by default."})}),"\n",(0,l.jsx)(t.h2,{id:"signatures",children:"Signatures"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"func New(config ...Config) fiber.Handler\n\ntype Handler interface {\n    New(config *Config) fiber.Handler\n}\n"})}),"\n",(0,l.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(t.p,{children:"Import the middleware package:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'import (\n    "github.com/gofiber/fiber/v3"\n    "github.com/gofiber/fiber/v3/middleware/limiter"\n)\n'})}),"\n",(0,l.jsx)(t.p,{children:"Once your Fiber app is initialized, use the middleware like this:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'// Initialize default config\napp.Use(limiter.New())\n\n// Or extend your config for customization\napp.Use(limiter.New(limiter.Config{\n    Next: func(c fiber.Ctx) bool {\n        return c.IP() == "127.0.0.1"\n    },\n    Max:          20,\n    MaxFunc: func(c fiber.Ctx) int {\n      return 20\n    },\n    Expiration:     30 * time.Second,\n    ExpirationFunc: func(c fiber.Ctx) time.Duration {\n      // Use longer expiration for sensitive endpoints\n      if c.Path() == "/login" {\n        return 60 * time.Second\n      }\n      return 30 * time.Second\n    },\n    KeyGenerator:          func(c fiber.Ctx) string {\n        return c.Get("x-forwarded-for")\n    },\n    LimitReached: func(c fiber.Ctx) error {\n        return c.SendFile("./toofast.html")\n    },\n    Storage: myCustomStorage{},\n}))\n'})}),"\n",(0,l.jsx)(t.h2,{id:"sliding-window",children:"Sliding window"}),"\n",(0,l.jsxs)(t.p,{children:["Instead of using the standard fixed window algorithm, you can enable the ",(0,l.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Sliding_window_protocol",children:"sliding window"})," algorithm."]}),"\n",(0,l.jsx)(t.p,{children:"An example configuration is:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"app.Use(limiter.New(limiter.Config{\n    Max:            20,\n    Expiration:     30 * time.Second,\n    LimiterMiddleware: limiter.SlidingWindow{},\n}))\n"})}),"\n",(0,l.jsx)(t.p,{children:"Each new window also considers the previous one (if any). The rate is calculated as:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-text",children:"weightOfPreviousWindow = previousWindowRequests * (elapsedInCurrentWindow / Expiration)\nrate = weightOfPreviousWindow + currentWindowRequests\n"})}),"\n",(0,l.jsx)(t.h2,{id:"dynamic-limit",children:"Dynamic limit"}),"\n",(0,l.jsxs)(t.p,{children:["You can also calculate the limit dynamically using the ",(0,l.jsx)(t.code,{children:"MaxFunc"})," parameter. It receives the request context and allows you to compute a different limit for each request."]}),"\n",(0,l.jsx)(t.p,{children:"Example:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:'app.Use(limiter.New(limiter.Config{\n    MaxFunc:  func(c fiber.Ctx) int {\n      return getUserLimit(ctx.Param("id"))\n    },\n    Expiration:     30 * time.Second,\n}))\n'})}),"\n",(0,l.jsx)(t.h2,{id:"dynamic-expiration",children:"Dynamic expiration"}),"\n",(0,l.jsxs)(t.p,{children:["You can also calculate the expiration dynamically using the ",(0,l.jsx)(t.code,{children:"ExpirationFunc"})," parameter. It receives the request context and allows you to set a different expiration window for each request."]}),"\n",(0,l.jsx)(t.p,{children:"Example:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"app.Use(limiter.New(limiter.Config{\n    Max:     20,\n    ExpirationFunc: func(c fiber.Ctx) time.Duration {\n      return getExpirationForRoute(c.Path())\n    },\n}))\n"})}),"\n",(0,l.jsx)(t.h2,{id:"config",children:"Config"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Property"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Next"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) bool"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Next defines a function to skip this middleware when it returns true."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"nil"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Max"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"int"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Maximum number of recent connections within ",(0,l.jsx)(t.code,{children:"Expiration"})," seconds before sending a 429 response."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"5"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"MaxFunc"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) int"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Function that calculates the maximum number of recent connections within ",(0,l.jsx)(t.code,{children:"Expiration"})," seconds before sending a 429 response."]}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["A function that returns ",(0,l.jsx)(t.code,{children:"cfg.Max"})]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"KeyGenerator"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) string"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Function to generate custom keys; uses ",(0,l.jsx)(t.code,{children:"c.IP()"})," by default."]}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["A function using ",(0,l.jsx)(t.code,{children:"c.IP()"})," as the default"]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Expiration"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"time.Duration"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Duration to keep request records in memory."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"1 * time.Minute"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"ExpirationFunc"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"func(fiber.Ctx) time.Duration"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Function that calculates the expiration duration dynamically."}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["A function that returns ",(0,l.jsx)(t.code,{children:"cfg.Expiration"})]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"LimitReached"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fiber.Handler"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Called when a request exceeds the limit."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"A function sending a 429 response"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"SkipFailedRequests"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["When set to ",(0,l.jsx)(t.code,{children:"true"}),", requests with status code \u2265 400 aren't counted."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"false"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"SkipSuccessfulRequests"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["When set to ",(0,l.jsx)(t.code,{children:"true"}),", requests with status code < 400 aren't counted."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"false"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"DisableHeaders"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["When set to ",(0,l.jsx)(t.code,{children:"true"}),", the middleware omits rate limit headers (",(0,l.jsx)(t.code,{children:"X-RateLimit-*"})," and ",(0,l.jsx)(t.code,{children:"Retry-After"}),")."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"false"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"DisableValueRedaction"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"bool"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Disables redaction of limiter keys in error messages and logs."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"false"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Storage"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fiber.Storage"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Persists middleware state."}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"An in-memory store for this process only"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"LimiterMiddleware"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"limiter.Handler"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Selects the algorithm implementation. Implementations now receive a pointer to the active config when their ",(0,l.jsx)(t.code,{children:"New"})," method is invoked."]}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"A new Fixed Window Rate Limiter"})]})]})]}),"\n",(0,l.jsx)(t.admonition,{type:"note",children:(0,l.jsxs)(t.p,{children:["A custom store can be used if it implements the ",(0,l.jsx)(t.code,{children:"Storage"})," interface - more details and an example can be found in ",(0,l.jsx)(t.code,{children:"store.go"}),"."]})}),"\n",(0,l.jsx)(t.h2,{id:"default-config",children:"Default Config"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"var ConfigDefault = Config{\n    Max:        5,\n    MaxFunc: func(c fiber.Ctx) int {\n      return 5\n    },\n    Expiration: 1 * time.Minute,\n    // ExpirationFunc defaults to nil and is set dynamically to return cfg.Expiration\n    KeyGenerator: func(c fiber.Ctx) string {\n        return c.IP()\n    },\n    LimitReached: func(c fiber.Ctx) error {\n        return c.SendStatus(fiber.StatusTooManyRequests)\n    },\n    SkipFailedRequests: false,\n    SkipSuccessfulRequests: false,\n    DisableHeaders:        false,\n    DisableValueRedaction: false,\n    LimiterMiddleware: FixedWindow{},\n}\n"})}),"\n",(0,l.jsx)(t.h3,{id:"custom-storagedatabase",children:"Custom Storage/Database"}),"\n",(0,l.jsxs)(t.p,{children:["You can use any storage from our ",(0,l.jsx)(t.a,{href:"https://github.com/gofiber/storage/",children:"storage"})," package."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-go",children:"storage := sqlite3.New() // From github.com/gofiber/storage/sqlite3/v2\n\napp.Use(limiter.New(limiter.Config{\n    Storage: storage,\n}))\n"})})]})}function x(e={}){let{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},84429:function(e,t,i){i.d(t,{R:()=>s,x:()=>d});var n=i(96540);let l={},r=n.createContext(l);function s(e){let t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);